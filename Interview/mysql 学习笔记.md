# mysql 学习笔记
#### 索引的作用是减少查询的复杂度，搜索树可以把复杂度降到logn。但是mysql由于索引数据是保存在磁盘上的，所以还需要考虑磁盘io的问题
#### 磁盘io的开销是非常巨大的，大概会在内存开销的十万倍左右。所以计算机在进行磁盘io的时候，除了会加载指定位置的数据，还会将附近的内容一起加载到内存中。也就是预热的过程，每次加载的数据叫做一个page，大概是4k - 8k


#### 讲到mysql的底层索引结构，
![b+树](img/mysql-b+.jpg)

#### 所以几层就代表需要几次io，io次数跟高度h有关
#### 所以可以假设，如果每次磁盘io的大小相同的话，每个数据块中索引字段越小，存储的数据量越大，则会使得h越小。所以建议索引的值都尽可能小一点。且B+树会选择将记录的信息记录在叶子节点中。

#### 当数据项是复合的数据结构，比如(name,age,sex)的时候，会按照从左到右匹配的方式去搜索，所以如果只给定了age和sex，则会不知道如何进行查找。这就是最左匹配原则

建索引的几大原则
1.最左前缀匹配原则，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(>、<、between、like)就停止匹配，比如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。 

2.=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式。 

3.尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录。

4.索引列不能参与计算，保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’)。

5.尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。